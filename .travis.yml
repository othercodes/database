language: php

php:
  - '5.5'
  - '5.6'
  - '7.0'

dist: trusty
sudo: required
addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6

services:
  - mysql
  - postgresql

before_script:
  - mysql -u root -e "CREATE DATABASE IF NOT EXISTS test;"
  - mysql -u root test < examples/sql/mysql.sql
  - mysql -u root -e "CREATE USER 'test'@'localhost' IDENTIFIED BY '';"
  - mysql -u root -e "GRANT ALL ON test.* TO 'test'@'localhost';"
  - psql -U postgres -c "CREATE DATABASE test;"
  - psql -U postgres -d test -a -f examples/sql/pgsql.sql
  - psql -U postgres -c "CREATE USER test WITH PASSWORD '';"
  - psql -U postgres -d test -c "ALTER TABLE ts_users OWNER TO test;"
  - touch examples/test.sqlite
  - sqlite3 examples/test.sqlite < examples/sql/sqlite.sql

install:
  - composer install

script:
  - ./vendor/bin/phpunit -c ./phpunit.xml
  - ./vendor/bin/phpunit --coverage-clover=coverage.xml

after_success:
      - bash <(curl -s https://codecov.io/bash)